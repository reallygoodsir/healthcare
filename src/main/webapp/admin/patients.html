<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Healthcare â€” Patients</title>
    <style>
        :root{
          --bg:#f4f7fb;
          --card:#fff;
          --accent:#2563eb;
          --accent-hover:#1d4ed8;
          --danger:#dc2626;
          --text:#111827;
          --muted:#6b7280;
        }
        body{margin:0;font-family:system-ui,Arial,sans-serif;background:var(--bg);color:var(--text);}
        header{background:var(--accent);color:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;}
        header h1{margin:0;font-size:1.5rem;}
        header button{background:#fff;color:var(--accent);border:none;padding:0.5rem 1rem;border-radius:0.5rem;cursor:pointer;font-weight:600;}
        main{padding:2rem;max-width:1200px;margin:auto;}
        table{width:100%;border-collapse:collapse;background:var(--card);box-shadow:0 1px 3px rgba(0,0,0,0.1);}
        th,td{padding:0.75rem 1rem;text-align:left;border-bottom:1px solid #e5e7eb;}
        th{background:#f9fafb;font-weight:600;}
        tr:hover td{background:#f3f4f6;}
        .actions button{margin-right:0.5rem;padding:0.25rem 0.75rem;border-radius:0.375rem;border:none;cursor:pointer;font-size:0.9rem;}
        .actions .edit{background:var(--accent);color:#fff;}
        .actions .edit:hover{background:var(--accent-hover);}
        .actions .delete{background:var(--danger);color:#fff;}
        .actions .delete:hover{background:#b91c1c;}
        /* Modal */
        #modalBackdrop{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:1000;}
        #patientModal{background:#fff;border-radius:0.75rem;max-width:500px;width:100%;padding:1.5rem;box-shadow:0 10px 25px rgba(0,0,0,0.2);}
        #patientModal h2{margin-top:0;font-size:1.25rem;}
        .form-group{margin-bottom:1rem;}
        label{display:block;font-weight:600;margin-bottom:0.25rem;}
        input,select{width:100%;padding:0.5rem;border:1px solid #d1d5db;border-radius:0.375rem;font-size:1rem;}
        .modal-actions{display:flex;justify-content:flex-end;gap:0.5rem;margin-top:1rem;}
        .btn{padding:0.5rem 1rem;border-radius:0.5rem;font-weight:600;border:none;cursor:pointer;}
        .btn.save{background:var(--accent);color:#fff;}
        .btn.save:hover{background:var(--accent-hover);}
        .btn.cancel{background:#e5e7eb;}
        .btn.cancel:hover{background:#d1d5db;}
        .error{color:var(--danger);font-size:0.9rem;margin-top:0.25rem;}
        .small{font-size:0.8rem;color:var(--muted);}
    </style>
</head>
<body>
<header>
    <h1>Patients</h1>
    <button id="createBtn">Create Patient</button>
</header>
<main>
    <table id="patientsTable">
        <thead>
        <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Date of Birth</th>
            <th>Address</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</main>

<!-- Modal -->
<div id="modalBackdrop" aria-hidden="true">
    <div id="patientModal">
        <h2 id="modalTitle">Create Patient</h2>
        <input type="hidden" id="patientId"/>
        <div class="form-group">
            <label for="firstName">First Name</label>
            <input type="text" id="firstName"/>
        </div>
        <div class="form-group">
            <label for="lastName">Last Name</label>
            <input type="text" id="lastName"/>
        </div>
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email"/>
        </div>
        <div class="form-group">
            <label for="phone">Phone</label>
            <input type="text" id="phone"/>
        </div>
        <div class="form-group">
            <label for="dob">Date of Birth</label>
            <input type="date" id="dob"/>
        </div>
        <div class="form-group">
            <label for="address">Address</label>
            <input type="text" id="address"/>
        </div>
        <div class="error" id="formError" style="display:none"></div>
        <div id="modalMessage" style="display:none;margin-top:0.5rem;font-size:0.9rem"></div>
        <div class="modal-actions">
            <button class="btn cancel" id="cancelBtn">Cancel</button>
            <button class="btn save" id="saveBtn">Create</button>
        </div>
    </div>
</div>

<script>
    const API_BASE='http://localhost:8080/healthcare/api/patients';
    const tableBody=document.querySelector('#patientsTable tbody');
    const createBtn=document.getElementById('createBtn');
    const modalBackdrop=document.getElementById('modalBackdrop');
    const modalTitle=document.getElementById('modalTitle');
    const cancelBtn=document.getElementById('cancelBtn');
    const saveBtn=document.getElementById('saveBtn');
    const formError=document.getElementById('formError');
    const modalMessage=document.getElementById('modalMessage');

    const form={
        patientId:document.getElementById('patientId'),
        firstName:document.getElementById('firstName'),
        lastName:document.getElementById('lastName'),
        email:document.getElementById('email'),
        phone:document.getElementById('phone'),
        dob:document.getElementById('dob'),
        address:document.getElementById('address')
    };

    async function loadPatients(){
        try{
            const resp=await fetch(API_BASE);
            if(!resp.ok) throw new Error(`HTTP ${resp.status}`);
            const patients=await resp.json();
            tableBody.innerHTML='';
            for(const p of patients){
                const tr=document.createElement('tr');
                tr.innerHTML=`<td>${p.firstName||''}</td>
                                <td>${p.lastName||''}</td>
                                <td>${p.email||''}</td>
                                <td>${p.phone||''}</td>
                                <td>${p.dateOfBirth||''}</td>
                                <td>${p.address||''}</td>
                                <td class="actions">
                                    <button class="edit">Edit</button>
                                    <button class="delete">Delete</button>
                                </td>`;
                tableBody.appendChild(tr);
                tr.querySelector('.edit').onclick=()=>openModal('edit',p);
                tr.querySelector('.delete').onclick=()=>deletePatient(p.id);
            }
        }catch(err){console.error('Failed to load patients',err);}
    }

    async function deletePatient(id){
        if(!confirm('Delete this patient?')) return;
        try{
            const resp=await fetch(`${API_BASE}/${id}`,{method:'DELETE'});
            if(!resp.ok) throw new Error(`HTTP ${resp.status}`);
            await loadPatients();
        }catch(err){alert('Failed to delete patient');}
    }

    async function submitPatient(payload){
        try{
            const method=payload.id?'PUT':'POST';
            const resp=await fetch(API_BASE,{
                method,
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify(payload)
            });

            if(!resp.ok){
                let message='Failed to save patient';
                try{
                    const data=await resp.json();
                    if(data && data.message) message=data.message;
                }catch{} // ignore parse errors
                modalMessage.textContent=message;
                modalMessage.style.color='var(--danger)';
                modalMessage.style.display='block';
                return;
            }

            await loadPatients();
            closeModal();
        }catch(err){
            modalMessage.textContent='Failed to save patient';
            modalMessage.style.color='var(--danger)';
            modalMessage.style.display='block';
        }
    }

    function openModal(mode='create',patient=null){
        formError.style.display='none';
        modalMessage.style.display='none';

        if(mode==='create'){
            modalTitle.textContent='Create Patient';
            saveBtn.textContent='Create';
            form.patientId.value=''; form.firstName.value=''; form.lastName.value='';
            form.email.value=''; form.phone.value=''; form.dob.value=''; form.address.value='';
        } else {
            modalTitle.textContent='Edit Patient';
            saveBtn.textContent='Update';
            form.patientId.value=patient.id??'';
            form.firstName.value=patient.firstName??'';
            form.lastName.value=patient.lastName??'';
            form.email.value=patient.email??'';
            form.phone.value=patient.phone??'';
            form.dob.value=patient.dateOfBirth??'';
            form.address.value=patient.address??'';
        }
        modalBackdrop.style.display='flex';
        modalBackdrop.setAttribute('aria-hidden','false');
    }

    function closeModal(){
        modalBackdrop.style.display='none';
        modalBackdrop.setAttribute('aria-hidden','true');
    }

    saveBtn.addEventListener('click',async()=>{
        formError.style.display='none';
        modalMessage.style.display='none';
        const firstName=form.firstName.value.trim();
        const lastName=form.lastName.value.trim();
        if(!firstName||!lastName){
            formError.textContent='First name and last name are required.';
            formError.style.display='block';
            return;
        }
        const payload={
            id:form.patientId.value?Number(form.patientId.value):undefined,
            firstName,lastName,
            email:form.email.value.trim(),
            phone:form.phone.value.trim(),
            dateOfBirth:form.dob.value,
            address:form.address.value.trim()
        };
        await submitPatient(payload);
    });

    cancelBtn.addEventListener('click',closeModal);
    createBtn.addEventListener('click',()=>openModal('create'));

    loadPatients();
</script>
</body>
</html>
