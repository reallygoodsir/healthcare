<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Healthcare â€” Services</title>
  <style>
    :root{
      --bg:#f4f7fb;
      --card:#fff;
      --accent:#2563eb;
      --accent-hover:#1d4ed8;
      --danger:#dc2626;
      --text:#111827;
      --muted:#6b7280;
    }
    body{margin:0;font-family:system-ui,Arial,sans-serif;background:var(--bg);color:var(--text);}
    header{background:var(--accent);color:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;}
    header h1{margin:0;font-size:1.5rem;}
    header button{background:#fff;color:var(--accent);border:none;padding:0.5rem 1rem;border-radius:0.5rem;cursor:pointer;font-weight:600;}
    main{padding:2rem;max-width:800px;margin:auto;}
    table{width:100%;border-collapse:collapse;background:var(--card);box-shadow:0 1px 3px rgba(0,0,0,0.1);}
    th,td{padding:0.75rem 1rem;text-align:left;border-bottom:1px solid #e5e7eb;}
    th{background:#f9fafb;font-weight:600;}
    tr:hover td{background:#f3f4f6;}
    .actions button{margin-right:0.5rem;padding:0.25rem 0.75rem;border-radius:0.375rem;border:none;cursor:pointer;font-size:0.9rem;}
    .actions .edit{background:var(--accent);color:#fff;}
    .actions .edit:hover{background:var(--accent-hover);}
    .actions .delete{background:var(--danger);color:#fff;}
    .actions .delete:hover{background:#b91c1c;}
    /* Modal */
    #modalBackdrop{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:1000;}
    #serviceModal{background:#fff;border-radius:0.75rem;max-width:400px;width:100%;padding:1.5rem;box-shadow:0 10px 25px rgba(0,0,0,0.2);}
    #serviceModal h2{margin-top:0;font-size:1.25rem;}
    .form-group{margin-bottom:1rem;}
    label{display:block;font-weight:600;margin-bottom:0.25rem;}
    input{width:100%;padding:0.5rem;border:1px solid #d1d5db;border-radius:0.375rem;font-size:1rem;}
    .modal-actions{display:flex;justify-content:flex-end;gap:0.5rem;margin-top:1rem;}
    .btn{padding:0.5rem 1rem;border-radius:0.5rem;font-weight:600;border:none;cursor:pointer;}
    .btn.save{background:var(--accent);color:#fff;}
    .btn.save:hover{background:var(--accent-hover);}
    .btn.cancel{background:#e5e7eb;}
    .btn.cancel:hover{background:#d1d5db;}
    .error{color:var(--danger);font-size:0.9rem;margin-top:0.25rem;}
    .small{font-size:0.8rem;color:var(--muted);}
  </style>
</head>
<body>
<header>
  <h1>Services</h1>
  <button id="createBtn">Create Service</button>
</header>
<main>
  <table id="servicesTable">
    <thead>
    <tr>
      <th>Name</th>
      <th>Price</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<!-- Modal -->
<div id="modalBackdrop" aria-hidden="true">
  <div id="serviceModal">
    <h2 id="modalTitle">Create Service</h2>
    <input type="hidden" id="serviceId"/>
    <div class="form-group">
      <label for="name">Name</label>
      <input type="text" id="name"/>
    </div>
    <div class="form-group">
      <label for="price">Price</label>
      <input type="number" id="price" min="0"/>
    </div>
    <div class="error" id="formError" style="display:none"></div>
    <div id="modalMessage" style="display:none;margin-top:0.5rem;font-size:0.9rem"></div>
    <div class="modal-actions">
      <button class="btn cancel" id="cancelBtn">Cancel</button>
      <button class="btn save" id="saveBtn">Create</button>
    </div>
  </div>
</div>

<script>
  const API_BASE='http://localhost:8080/healthcare/api/services';
  const tableBody=document.querySelector('#servicesTable tbody');
  const createBtn=document.getElementById('createBtn');
  const modalBackdrop=document.getElementById('modalBackdrop');
  const modalTitle=document.getElementById('modalTitle');
  const cancelBtn=document.getElementById('cancelBtn');
  const saveBtn=document.getElementById('saveBtn');
  const formError=document.getElementById('formError');
  const modalMessage=document.getElementById('modalMessage');

  const form={
    serviceId:document.getElementById('serviceId'),
    name:document.getElementById('name'),
    price:document.getElementById('price')
  };

  async function loadServices(){
    try{
      const resp=await fetch(API_BASE);
      if(!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const services=await resp.json();
      tableBody.innerHTML='';
      for(const s of services){
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${s.name||''}</td>
                      <td>${s.price||0}</td>
                      <td class="actions">
                        <button class="edit">Edit</button>
                        <button class="delete">Delete</button>
                      </td>`;
        tableBody.appendChild(tr);
        tr.querySelector('.edit').onclick=()=>openModal('edit',s);
        tr.querySelector('.delete').onclick=()=>deleteService(s.id);
      }
    }catch(err){console.error('Failed to load services',err);}
  }

  async function deleteService(id){
    if(!confirm('Delete this service?')) return;
    try{
      const resp=await fetch(`${API_BASE}/${id}`,{method:'DELETE'});
      if(!resp.ok) throw new Error(`HTTP ${resp.status}`);
      await loadServices();
    }catch(err){alert('Failed to delete service');}
  }

  async function submitService(payload){
    try{
      const method=payload.id?'PUT':'POST';
      const resp=await fetch(API_BASE,{
        method,
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(payload)
      });

      if(!resp.ok){
        let message='Failed to save service';
        try{
          const data=await resp.json();
          if(data && data.message) message=data.message;
        }catch{} // ignore JSON errors
        modalMessage.textContent=message;
        modalMessage.style.color='var(--danger)';
        modalMessage.style.display='block';
        return;
      }

      await loadServices();
      closeModal();
    }catch(err){
      modalMessage.textContent='Failed to save service';
      modalMessage.style.color='var(--danger)';
      modalMessage.style.display='block';
    }
  }

  function openModal(mode='create',service=null){
    formError.style.display='none';
    modalMessage.style.display='none';

    if(mode==='create'){
      modalTitle.textContent='Create Service';
      saveBtn.textContent='Create';
      form.serviceId.value='';
      form.name.value='';
      form.price.value='';
    } else {
      modalTitle.textContent='Edit Service';
      saveBtn.textContent='Update';
      form.serviceId.value=service.id??'';
      form.name.value=service.name??'';
      form.price.value=service.price??'';
    }
    modalBackdrop.style.display='flex';
    modalBackdrop.setAttribute('aria-hidden','false');
  }

  function closeModal(){
    modalBackdrop.style.display='none';
    modalBackdrop.setAttribute('aria-hidden','true');
  }

  saveBtn.addEventListener('click',async()=>{
    formError.style.display='none';
    modalMessage.style.display='none';
    const name=form.name.value.trim();
    const price=form.price.value.trim();
    if(!name){
      formError.textContent='Service name is required.';
      formError.style.display='block';
      return;
    }
    if(!price || isNaN(price) || Number(price)<0){
      formError.textContent='Valid price is required.';
      formError.style.display='block';
      return;
    }
    const payload={
      id:form.serviceId.value?Number(form.serviceId.value):undefined,
      name,
      price:Number(price)
    };
    await submitService(payload);
  });

  cancelBtn.addEventListener('click',closeModal);
  createBtn.addEventListener('click',()=>openModal('create'));

  loadServices();
</script>
</body>
</html>
